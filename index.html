<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>WA COVID-19 Vaccination Rates</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.5.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.5.0/mapbox-gl.js"></script>
    <style>
    h2, h3 {
    margin: 10px;
    font-size: 18px;
    }

    h3 {
    font-size: 16px;
    }

    p {
    margin: 10px;
    }

    #map {
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    width: 100%;
    }

    .map-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    background: rgba(255, 255, 255, 0.8);
    border-style: solid;
    border-width: 1px;
    border-color: rgba(0, 0, 0, 0.2);
    margin-left: 20px;
    font-family: Arial, sans-serif;
    overflow: auto;
    border-radius: 3px;
    }

    #features {
    top: 0;
    height: 100px;
    margin-top: 20px;
    width: 370px;
    }

    #legend {
    padding: 10px;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    line-height: 18px;
    height: 190px;
    margin-bottom: 40px;
    width: 180px;
    }

    .legend-key {
    display: inline-block;
    border-radius: 20%;
    width: 10px;
    height: 10px;
    margin-right: 5px;
    }

    .mapboxgl-canvas-container.mapboxgl-interactive,
    .mapboxgl-ctrl-group button.mapboxgl-ctrl-compass {
    cursor: unset;
    }
    </style>
</head>

<body>
    <div id="map"></div>

    <div class="map-overlay" id="features">
        <h2>Washington COVID-19 Vaccination Rates</h2>
        <div id="text-description">
            <p>Hover over a county!</p>
        </div>
    </div>

    <div class="map-overlay" id="legend"></div>

    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoibmFuY3kzMjQiLCJhIjoiY21oMTEyejlmMDY1YzJycHVwYXVyZ2U1ZiJ9.YSOrhRs2Nuc7-00ALC3Q_w';

        const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/light-v10',
        zoom: 6.2,   // zoomed in on Washington
        center: [-120.5, 47.3]
  });

  async function geojsonFetch() {
    let response = await fetch('assets/wa-covid-data-102521.geojson');
    let covidData = await response.json();

    map.on('load', function addData() {
        map.addSource('covid', {
            type: 'geojson',
            data: covidData
        });

    map.addLayer({
    id: 'covid-layer',
    type: 'fill',
    source: 'covid',
        paint: {
        'fill-color': [
        'step',
        ['get', 'fullyVaxPer10k'],
        '#BBDFFA',   // very light blue (0–4999)
        5000, '#97BAEC',   // light
        6000, '#6987D5',   // medium-light
        7000, '#445BC1',   // medium
        8000, '#2C43B8',   // medium-dark
        9000, '#1727AE',   // dark
        10000, '#003396'   // very dark navy
        ],
        'fill-outline-color': '#BBBBBB',
        'fill-opacity': 0.7
        }
    });

    // legend
    const layers = [
    '0–4999',
    '5000–5999',
    '6000–6999',
    '7000–7999',
    '8000–8999',
    '9000–9999',
    '10000+'
    ];
    const colors = [
    '#BBDFFA',
    '#97BAEC',   
    '#6987D5', 
    '#445BC1',   
    '#2C43B8',   
    '#1727AE',   
    '#003396' 
    ];

    const legend = document.getElementById('legend');
    legend.innerHTML = "<b>Fully Vaccinated<br>(per 10k people)</b><br><br>";

    layers.forEach((layer, i) => {
    const color = colors[i];
    const item = document.createElement('div');
    const key = document.createElement('span');
    key.className = 'legend-key';
    key.style.backgroundColor = color;

    const value = document.createElement('span');
    value.innerHTML = layer;
    item.appendChild(key);
    item.appendChild(value);
    legend.appendChild(item);
    });

    // ability to hover
    map.on('mousemove', ({ point }) => {
    const county = map.queryRenderedFeatures(point, { layers: ['covid-layer'] });
    document.getElementById('text-description').innerHTML = county.length ?
    `<h3>${county[0].properties.name} County</h3>
       <p><strong><em>${county[0].properties.fullyVaxPer10k}</em></strong> fully vaccinated per 10k</p>`
    : `<p>Hover over a county!</p>`;
});


});
}
    geojsonFetch();
    </script>
</body>
</html>
